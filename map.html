<!DOCTYPE html>
<html>
<head>
  <title>Life Expectancy Factor Impact Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <h1>Life Expectancy Factor Impact Analysis</h1>
  <p>As society and technology have rapidly advanced, there has been a notable increase in human life expectancy in recent years. However, it is important to acknowledge that the factors contributing to this extension in lifespan are multifaceted and cannot be attributed to a single variable. The objective of this project is to facilitate a comprehensive understanding of the diverse elements that correlate with life expectancy.</p>
  <select id="chartSelector">
    <option value="lifeExpectancy">Life Expectancy World Map</option>
    <option value="schooling">The Relationship between Life Expectancy and Education</option>
    <option value="GDP">The Relationship between Life Expectancy and GDP</option>
  </select>
  <div id="vegaChart"></div>

  <script>
    const chartSelector = document.getElementById('chartSelector');
    const vegaChart = document.getElementById('vegaChart');

    const lifeExpectancySpec =       
{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Life Expectancy World map and Line Chart",
  "width": 1000, // Increased width
  "height": 800, // Increased height
  "projection": {"type": "identity", "reflectY": true},
  "vconcat": [
    {
      "width": 1000, // Adjusted width for the map
      "height": 400, // Adjusted height for the map
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape"},
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xiangjun-Xue/Life_expectancy/main/Life-Expectancy-WHO.csv"
            },
            "key": "Country",
            "fields": ["Life_expectancy"]
          }
        }
      ],
      "encoding": {
        "color": {
          "field": "Life_expectancy",
          "type": "quantitative",
          "scale": {"type": "log", "scheme": "viridis"} // Added a color scheme for better visualization
        },
        "tooltip": [
          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
          {"field": "Life_expectancy", "type": "quantitative", "title": "Life Expectancy"}
        ]
      }
    },
    {
      "width": 1000, // Adjusted width for the line chart
      "height": 400, // Adjusted height for the line chart
      "data": {
        "url": "https://raw.githubusercontent.com/Xiangjun-Xue/Life_expectancy/main/Life-Expectancy-WHO.csv"
      },
      "transform": [
        {
          "aggregate": [{"op": "mean", "field": "Life_expectancy", "as": "mean_life_expectancy"}],
          "groupby": ["Year"]
        }
      ],
      "mark": "line",
      "encoding": {
        "x": {"field": "Year", "type": "temporal", "title": "Year"},
        "y": {"field": "mean_life_expectancy", "type": "quantitative", "title": "Mean Life Expectancy", "scale": {"domain": [60, 80]}}, // Change y-axis scale
        "color": {"value": "steelblue"}, // You can change the color as needed
        "tooltip": [
          {"field": "Year", "type": "temporal", "title": "Year"},
          {"field": "mean_life_expectancy", "type": "quantitative", "title": "Mean Life Expectancy"}
        ]
      }
    }
  ]
};

    const schoolingSpec = 
      {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Life Expectancy and Education World map",
  "width": 1000,
  "height": 800,
  "projection": {"type": "identity", "reflectY": true},
  "vconcat": [
    {
      "width": 1000,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape"},
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xiangjun-Xue/Life_expectancy/main/Life-Expectancy-WHO.csv"
            },
            "key": "Country",
            "fields": ["Schooling", "Region"] // Include "Region" in fields
          }
        }
      ],
      "encoding": {
        "color": {
          "field": "Schooling",
          "type": "quantitative",
          "scale": {"type": "log", "scheme": "viridis"}
        },
        "tooltip": [
          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
          {"field": "Schooling", "type": "quantitative", "title": "Schooling"}
        ]
      },
      "selection": {
        "brush": {"type": "interval", "encodings": ["x", "y"]}
      }
    },
    {
      "width": 1000,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/Xiangjun-Xue/Life_expectancy/main/Life-Expectancy-WHO.csv"
      },
      "params": [{
        "name": "brush",
        "select": "interval",
        "value": {"x": [55, 160], "y": [13, 37]}
      }],
      "transform": [
        {
          "joinaggregate": [{"op": "min", "field": "Country", "as": "Country"}],
          "aggregate": [{"op": "mean", "field": "Life_expectancy", "as": "mean_life_expectancy"}],
          "groupby": ["Schooling", "Country", "Region"] // Group by "Region"
        }
      ],
      "mark": {
        "type": "circle",
        "size": 50,
        "opacity": 0.7
      },
      "encoding": {
        "x": {"field": "Schooling", "type": "quantitative", "title": "Mean of Schooling"},
        "y": {"field": "mean_life_expectancy", "type": "quantitative", "title": "Mean of Life Expectancy"},
        "shape": {"field": "Region", "type": "nominal"}, // Use different shapes for "Region"
        "color": {
          "condition":{"param": "brush", "field": "Region", "type": "nominal"},
          "value": "grey"
          }, // Color by "Region"
        
      },
      "legend": {"title": "Region"} // Display a legend for "Region"
    },
    {
      "mark": {"type": "text", "align": "center", "baseline": "top", "text": "This is a visualization of Life Expectancy and Schooling data.", "fontSize": 14, "x": 500, "y": 10, "color": "black"}
    }
  ]
};
    const GDPSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Life Expectancy and GDP World map",
  "width": 1000,
  "height": 800,
  "projection": {"type": "identity", "reflectY": true},
  "vconcat": [
    {
      "width": 1000,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape"},
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Xiangjun-Xue/Life_expectancy/main/Life-Expectancy-WHO.csv"
            },
            "key": "Country",
            "fields": ["GDP_per_capita", "Region", "Life_expectancy"] // Include "Region" and "Life_expectancy" in fields
          }
        }
      ],
      "encoding": {
        "color": {
          "field": "GDP_per_capita",
          "type": "quantitative",
          "scale": {"type": "log", "scheme": "viridis"}
        },
        "tooltip": [
          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
          {"field": "GDP_per_capita", "type": "quantitative", "title": "GDP_per_capita"},
          {"field": "Life_expectancy", "type": "quantitative", "title": "Life Expectancy"} // Added life expectancy to the tooltip
        ]
      },
      "selection": {
        "brush": {"type": "interval", "encodings": ["x", "y"]}
      }
    },
    {
      "width": 1000,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/Xiangjun-Xue/Life_expectancy/main/Life-Expectancy-WHO.csv"
      },
      "transform": [
        {
          "joinaggregate": [{"op": "min", "field": "Country", "as": "Country"}],
          "aggregate": [{"op": "mean", "field": "Life_expectancy", "as": "mean_life_expectancy"}],
          "groupby": ["GDP_per_capita", "Country", "Region"] // Group by "Region"
        }
      ],
      "mark": {
        "type": "circle",
        "size": 50,
        "opacity": 0.7
      },
      "encoding": {
        "x": {"field": "GDP_per_capita", "type": "quantitative", "title": "Mean of GDP_per_capita"},
        "y": {"field": "mean_life_expectancy", "type": "quantitative", "title": "Mean of Life Expectancy"},
        "shape": {"field": "Region", "type": "nominal"}, // Use different shapes for "Region"
        "color": {
          "condition": {"param": "brush", "field": "Region", "type": "nominal"},
          "value": "grey"
        }, // Color by "Region"
        "tooltip": [
          {"field": "Country", "type": "nominal", "title": "Country"},
          {"field": "GDP_per_capita", "type": "quantitative", "title": "GDP_per_capita"},
          {"field": "mean_life_expectancy", "type": "quantitative", "title": "Mean Life Expectancy"} // Added mean life expectancy to the tooltip
        ]
      },
      "legend": {"title": "Region"} // Display a legend for "Region"
    },
    {
      "mark": {"type": "text", "align": "center", "baseline": "top", "text": "This is a visualization of Life Expectancy and GDP_per_capita data.", "fontSize": 14, "x": 500, "y": 10, "color": "black"}
    }
  ]
};
      

    function renderChart(selectedChart) {
      vegaEmbed(vegaChart, selectedChart).then((result) => {
        // Handle any additional configuration or actions here
      }).catch(console.error);
    }

    chartSelector.addEventListener('change', () => {
      const selectedValue = chartSelector.value;
      if (selectedValue === 'lifeExpectancy') {
        renderChart(lifeExpectancySpec);
      } else if (selectedValue === 'schooling') {
        renderChart(schoolingSpec);
      }else if (selectedValue === 'GDP'){
        renderChart(GDPSpec);
      }
    });

    // Initial rendering (you can choose the default chart)
    renderChart(lifeExpectancySpec);
  </script>
</body>
</html>
